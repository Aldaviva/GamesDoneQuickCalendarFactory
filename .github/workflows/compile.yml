name: Compile program

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  compile:
    env:
      ProjectName: GamesDoneQuickCalendarFactory

    strategy:
      matrix:
        include:
          - os: ubuntu-latest
            targetPlatform: linux-x64
          - os: windows-latest
            targetPlatform: win-x64

    runs-on: ${{ matrix.os }}

    steps:
      - name: Clone
        uses: actions/checkout@v3
          
      - name: Publish
        run: dotnet publish --configuration Release -p:PublishSingleFile=true --runtime ${{ matrix.targetPlatform }} --self-contained false --verbosity normal

      - name: Generate test calendar (discarded)
        run: ${{ env.ProjectName }}/bin/Release/net6.0/${{ matrix.targetPlatform }}/publish/${{ env.ProjectName }}
        
      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: ${{ env.ProjectName }}-${{ matrix.targetPlatform }}
          path: |
            ${{ env.ProjectName }}/bin/Release/net6.0/${{ matrix.targetPlatform }}/publish/${{ env.ProjectName }}.exe
            ${{ env.ProjectName }}/bin/Release/net6.0/${{ matrix.targetPlatform }}/publish/${{ env.ProjectName }}
          if-no-files-found: error